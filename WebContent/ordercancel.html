<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>NeuSoft introduction</title>
  <link rel="stylesheet" href="../SSM/layui/css/layui.css">
   <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.0.js"></script>
<script>
  var oid="";
  var starttime="";
  var endtime="";
  var url="";
  	$(function(){
  		$("#btn_submit").click(function(){
  			oid=$("#oid").val();
  			starttime=$("#test1-1").val();
  			endtime=$("#test1-2").val();
  			console.log("oid="+oid);
  			console.log("starttime="+starttime);
  			console.log("endtime="+endtime);
  			url='/SSM/test/OrderHandler_findOrder?status='+encodeURI(encodeURI("退款中"))+'&oid='+oid+'&starttime='+starttime+'&endtime='+endtime;
  			showtable(url);
  		});
  	});
  
  </script>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
  <div class="layui-header">
    <div class="layui-logo">NeuSoft</div>
    <!-- 头部区域（可配合layui已有的水平导航） -->
    <ul class="layui-nav layui-layout-right">
      <li class="layui-nav-item">
        <a href="javascript:;">
          <img src="../SSM/img/profile.jpg" class="layui-nav-img">
          RoyalSkye
        </a>
      </li>
      <li class="layui-nav-item"><a href="login.html">Logout</a></li>
    </ul>
  </div>
  
  <div class="layui-side layui-bg-black">
    <div class="layui-side-scroll">
      <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
      <ul class="layui-nav layui-nav-tree"  lay-filter="test">
        <li class="layui-nav-item ">
          <a class="" href="javascript:;">企业管理</a>
          <dl class="layui-nav-child">
          <dd><a href="index2.html">数据统计</a></dd>
            <dd><a href="index.html">企业基本信息</a></dd>
            <dd><a href="branchinfo.html">企业分部信息</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a href="javascript:;">师资管理</a>
          <dl class="layui-nav-child">
            <dd><a href="teacherinfo.html">师资力量</a></dd>
            <dd><a href="teacherimg.html">师资首页图片</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a href="javascript:;">课程管理</a>
          <dl class="layui-nav-child">
            <dd><a href="lessoninfo.html">课程信息管理</a></dd>
            <dd><a href="lessonimg.html">课程首页图片</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a href="javascript:;">预约管理</a>
          <dl class="layui-nav-child">
            <dd><a href="freelisteninfo.html">预约课程查询</a></dd>
            <dd><a href="freelistenorder.html">预约课程处理</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item layui-nav-itemed">
          <a href="javascript:;">订单管理</a>
          <dl class="layui-nav-child">
            <dd><a href="orderinfo.html">订单查询</a></dd>
            <dd><a href="orderrefund.html">退款处理</a></dd>
            <dd><a href="ordercancel.html">订单核销</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item">
          <a href="javascript:;">朋友圈管理</a>
          <dl class="layui-nav-child">
            <dd><a href="messageinfo.html">消息列表</a></dd>
            <dd><a href="messageimg.html">朋友圈首页图片</a></dd>
          </dl>
        </li>
      </ul>
    </div>
  </div>
  
  <div class="layui-body">
    <!-- 内容主体区域 -->
     <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
		  <legend>订单核销</legend>
		</fieldset>
    <div class="demoTable">
	  关键字：
	  <div class="layui-inline" float="left">
	    <input class="layui-input" name="oid" id="oid" placeholder="请输入搜索订单编号" autocomplete="off">
	  </div>
	  <div class="layui-inline" float="right">
	    <form class="layui-form" action="">
	      <label class="layui-form-label">订单状态:</label>
	       <div class="layui-input-inline">
	        <select name="modules" lay-verify="required" lay-search="">
	          <option value="">已付款</option>
	        </select>
	       </div>
	      <div class="layui-inline">
		      <label class="layui-form-label">下单时间:</label>
		      <div class="layui-input-inline">
		        <input type="text" class="layui-input" id="test1-1" placeholder="yyyy-MM-dd">
		      </div>
		      to
		      <div class="layui-input-inline">
		        <input type="text" class="layui-input" id="test1-2" placeholder="yyyy-MM-dd">
		      </div>
		    </div>
	   	</form>
	  </div>
	  <button class="layui-btn" data-type="reload" id="btn_submit" type="button">查询</button>
	</div>
<table class="layui-hide" id="LAY_table_user" lay-filter="demo">
<th lay-data="{fixed: 'right', width:178, align:'center', toolbar: '#barDemo'}"></th></table>	
  </div>
 
  <div class="layui-footer">
    <!-- 底部固定区域 -->
    © NeuSoft 
  </div>
</div>

<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="confirm">确认核销</a>
</script>

<script src="../SSM/layui/layui.js"></script>
<script>
//JavaScript代码区域
layui.use('element', function(){
  var element = layui.element;
  
});
url='/SSM/test/OrderHandler_findOrder?status='+encodeURI(encodeURI("已付款"))+'&oid=&starttime=&endtime=';
showtable(url);
function showtable(url){
layui.use('table', function(){	
  var table = layui.table;
  
table.on('tool(demo)', function(obj){
	var data = obj.data;
    console.log(obj);
    if(obj.event === 'confirm'){
    	var oid=obj.data.oid;
    	var status="已使用";
    		$.ajax({
				type:"post",
				url:"/SSM/test/OrderHandler_updateOrder",
				data:{oid:oid,status:status},
				dataType:"json",
				success:function(data){
					if(data.result){
						console.log(data);
						if(data.result){
							alert("confirm successfully");
							//obj.del();
							url='/SSM/test/OrderHandler_findOrder?status='+encodeURI(encodeURI("已付款"))+'&oid=&starttime=&endtime=';
							showtable(url);
						}else{
							alert("confirm failed");
						}
					} 
	 			 }
			});
		}
});
  
  
  //方法级渲染
  table.render({
    elem: '#LAY_table_user'
    ,url:url
    ,cols: [[
      {checkbox: true, fixed: true,width:'5%'}
      ,{field:'lid', title: '课程编号', width:'8%', sort: true, fixed: true}
      ,{field:'oid', title: '订单编号', sort: true,width:'8%'}
      ,{field:'nickname', title: '用户昵称', width:'8%'}
      ,{field:'tel', title: '用户电话', width:'10%'}
      ,{field:'total', title: '订单金额',sort: true,width:'8%'}
      ,{field:'actual', title: '实付金额', sort: true, width:'8%'}
      ,{field:'status', title: '订单状态', width:'10%'}
      ,{field:'ordertime', title: '下单时间', sort: true,width:'20%'}
      ,{field: 'operation', title: '操作',width:'15%', align:'center', toolbar: '#barDemo'}
    ]]
    ,even: true
    ,limits: [5, 7, 10]
    ,limit: 5 //每页默认显示的数量
    ,id: 'testReload'
    ,page: true
    ,done: function(res){
        console.log(res);
    }
  });

  var $ = layui.$, active = {
    reload: function(){
      var demoReload = $('#demoReload');
     
    }
  };

  
  });
  }

  layui.use('form', function(){
  var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
  form.render();
});  
	layui.use('laydate', function(){
	  var laydate = layui.laydate;
	  
	  //国际版
	  laydate.render({
	    elem: '#test1-1'
	    ,lang: 'en'
	  });
	  //国际版
	  laydate.render({
	    elem: '#test1-2'
	    ,lang: 'en'
	  });
  });

</script>
</body>
</html>